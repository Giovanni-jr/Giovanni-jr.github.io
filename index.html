<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ByteCraft - Acceso y Dashboard</title>

    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
          crossorigin="anonymous" referrerpolicy="no-referrer" />
          
    <link rel="stylesheet" href="style.css" /> 
</head>
<body class="login-body">

    <div id="login-screen">
        <div class="neon-background-effect"></div>

        <div class="login-card">
            <h2>Iniciar Sesión</h2>

            <form id="loginForm">
                <div class="input-glow-group">
                    <input type="text" id="username" required />
                    <label for="username">Usuario</label>
                </div>

                <div class="input-glow-group">
                    <input type="password" id="password" required />
                    <label for="password">Contraseña</label>
                </div>

                <button type="submit" class="neon-button">Entrar</button>
            </form>

            <p id="login-error" class="text-red-400 text-sm mt-4 hidden">
                Usuario o contraseña incorrectos.
            </p>
            <p class="text-xs text-gray-500 mt-2">Credenciales de prueba iniciales: Admin (admin/admin) | Usuario Normal (usuario/1234)</p>
        </div>
    </div>

    <div id="dashboard-screen" class="min-h-screen bg-gray-100 hidden">
        <nav class="bg-white shadow-md sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <span class="text-2xl font-bold text-gradient">ByteCraft</span>

                        <div class="hidden md:block ml-10">
                            <div class="flex items-baseline space-x-4" id="nav-container-desktop">
                                </div>
                        </div>
                    </div>

                    <div class="flex items-center space-x-3">
                        <button id="mobileMenuButton" class="md:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-controls="mobile-menu" aria-expanded="false">
                            <span class="sr-only">Abrir menú principal</span>
                            <i class="fas fa-bars h-6 w-6" id="menu-icon"></i> 
                        </button>

                        <button id="installButton" class="text-sm font-medium text-purple-600 hover:text-purple-800 hidden">
                            <i class="fas fa-download mr-1"></i> Instalar App
                        </button>
                        <button id="logoutButton" class="text-sm font-medium text-gray-600 hover:text-gray-800">
                            <i class="fas fa-sign-out-alt mr-1"></i> Salir
                        </button>
                    </div>
                </div>
            </div>

            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3" id="nav-container-mobile">
                    </div>
            </div>
        </nav>

        <main class="py-6">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div id="content-area" class="bg-white p-6 shadow-xl rounded-lg min-h-[70vh]">
                    <p class="text-gray-500">Cargando contenido...</p>
                </div>
            </div>
        </main>
    </div>

    <template id="template-dashboard">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Panel Principal</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="dashboard-card bg-purple-50 p-6 rounded-lg shadow-md border-t-4 border-purple-600">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-700">Proyectos Activos</h3>
                    <i class="fas fa-layer-group text-2xl text-purple-600"></i>
                </div>
                <p id="stats-proyectos" class="mt-4 text-4xl font-extrabold text-purple-900">0</p>
                <p class="text-sm text-gray-500 mt-1">Total de tareas no completadas.</p>
            </div>

            <div class="dashboard-card bg-blue-50 p-6 rounded-lg shadow-md border-t-4 border-blue-600">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-700">Clientes</h3>
                    <i class="fas fa-user-tie text-2xl text-blue-600"></i>
                </div>
                <p id="stats-clientes" class="mt-4 text-4xl font-extrabold text-blue-900">0</p>
                <p class="text-sm text-gray-500 mt-1">Clientes activos en la base de datos.</p>
            </div>

            <div class="dashboard-card bg-red-50 p-6 rounded-lg shadow-md border-t-4 border-red-600">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-700">Tareas Pendientes</h3>
                    <i class="fas fa-bell text-2xl text-red-600"></i>
                </div>
                <p id="stats-tareas" class="mt-4 text-4xl font-extrabold text-red-900">0</p>
                <p class="text-sm text-gray-500 mt-1">Tareas con estado 'Pendiente'.</p>
            </div>
        </div>

        <div class="mt-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Actividad Reciente</h2>
            <div class="bg-white p-4 rounded-lg shadow border border-gray-200">
                <p class="text-gray-500">Aquí se mostrarán los últimos movimientos (a implementar).</p>
            </div>
        </div>
    </template>

    <template id="template-clientes">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Gestión de Clientes</h1>

        <div class="bg-purple-50 p-6 rounded-lg shadow mb-6 border border-purple-200">
            <h2 id="clientFormTitle" class="text-2xl font-bold text-gray-800 mb-4">Registrar Nuevo Cliente</h2>
            <form id="clientForm" class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                <input type="hidden" id="clientId" value="">
                
                <div class="md:col-span-1">
                    <label for="clientName" class="block text-sm font-medium text-gray-700">Nombre del Cliente</label>
                    <input type="text" id="clientName" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
                
                <div class="md:col-span-1">
                    <label for="clientContact" class="block text-sm font-medium text-gray-700">Contacto Principal</label>
                    <input type="text" id="clientContact" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
                
                <div class="md:col-span-1">
                    <label for="clientPhone" class="block text-sm font-medium text-gray-700">Teléfono</label>
                    <input type="text" id="clientPhone" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>

                <div class="md:col-span-1">
                    <label for="clientStatus" class="block text-sm font-medium text-gray-700">Estado</label>
                    <select id="clientStatus" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white">
                        <option>Activo</option>
                        <option>Inactivo</option>
                    </select>
                </div>
                
                <div class="md:col-span-1 flex space-x-2">
                    <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 flex-grow">
                        <i class="fas fa-save mr-1"></i> Guardar
                    </button>
                    <button type="button" id="newClientButton" class="px-4 py-2 bg-gray-400 text-white rounded-md hover:bg-gray-500" title="Nuevo Cliente">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </form>
        </div>
        
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Lista de Clientes</h2>
        <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contacto</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Teléfono</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody id="client-list" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
    </template>

    <template id="template-tareas">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Gestión de Tareas</h1>

        <div class="bg-gray-50 p-6 rounded-lg shadow mb-6 border border-gray-200">
            <h2 id="taskFormTitle" class="text-2xl font-bold text-gray-800 mb-4">Crear Nueva Tarea</h2>
            <form id="taskForm" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <input type="hidden" id="taskId" value="">
                
                <div class="md:col-span-1">
                    <label for="taskTitle" class="block text-sm font-medium text-gray-700">Título de la Tarea</label>
                    <input type="text" id="taskTitle" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
                
                <div class="md:col-span-1">
                    <label for="taskStatus" class="block text-sm font-medium text-gray-700">Estado</label>
                    <select id="taskStatus" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white">
                        <option>Pendiente</option>
                        <option>En Progreso</option>
                        <option>Completada</option>
                    </select>
                </div>

                <div class="md:col-span-1">
                    <label for="taskPriority" class="block text-sm font-medium text-gray-700">Prioridad</label>
                    <select id="taskPriority" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white">
                        <option>Baja</option>
                        <option>Media</option>
                        <option>Alta</option>
                    </select>
                </div>
                
                <div class="md:col-span-1 flex space-x-2">
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex-grow">
                        <i class="fas fa-save mr-1"></i> Guardar
                    </button>
                    <button type="button" id="newTaskButton" class="px-4 py-2 bg-gray-400 text-white rounded-md hover:bg-gray-500" title="Nueva Tarea">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </form>
        </div>
        
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Lista de Tareas</h2>
        <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prioridad</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody id="task-list" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
    </template>

    <template id="template-usuarios">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Gestión de Usuarios</h1>

        <div class="bg-gray-500 p-6 rounded-lg shadow mb-6 border border-gray-200">
            <h2 id="userFormTitle" class="text-2xl font-bold text-white mb-4">Registrar Nuevo Usuario</h2>
            <form id="userForm" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <input type="hidden" id="userId" value="">
                
                <div class="md:col-span-1">
                    <label for="userUsername" class="block text-sm font-medium text-white">Nombre de Usuario</label>
                    <input type="text" id="userUsername" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
                
                <div class="md:col-span-1">
                    <label for="userPassword" class="block text-sm font-medium text-white">Contraseña</label>
                    <input type="password" id="userPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Obligatoria al crear">
                </div>
                
                <div class="md:col-span-1">
                    <label for="userRole" class="block text-sm font-medium text-white">Rol</label>
                    <select id="userRole" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-white">
                        <option>Administrador</option>
                        <option>Desarrollador</option>
                        <option>Diseñador</option>
                        <option>Invitado</option>
                    </select>
                </div>
                
                <div class="md:col-span-1 flex space-x-2">
                    <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 flex-grow">
                        <i class="fas fa-save mr-1"></i> Guardar Usuario
                    </button>
                    <button type="button" id="newUserButton" class="px-4 py-2 bg-gray-400 text-white rounded-md hover:bg-gray-500" title="Nuevo Usuario">
                        <i class="fas fa-user-plus"></i>
                    </button>
                </div>
            </form>
        </div>

        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg mb-6">
            <p class="text-yellow-700 font-semibold">
                <i class="fas fa-exclamation-triangle mr-2"></i> Advertencia de Seguridad:
            </p>
            <p class="text-yellow-600 text-sm mt-1">
                Esta gestión de usuarios es **SÓLO una simulación local** (usa `localStorage`). Las contraseñas se almacenan como texto plano por simplicidad de la demostración. **En una aplicación real, NUNCA se debe hacer esto.**
            </p>
        </div>

        <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody id="user-list" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
    </template>

    <template id="template-usuario-vista">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Vista de Tareas Asignadas</h1>

        <div class="bg-indigo-50 border-l-4 border-indigo-400 p-4 rounded-lg mb-6">
            <p class="text-indigo-700 font-semibold">
                <i class="fas fa-info-circle mr-2"></i> Vista de Tareas Limitada
            </p>
            <p class="text-indigo-600 text-sm mt-1">
                Desde esta vista solo puede visualizar tareas y marcarlas como **Entregadas/Completadas**.
            </p>
        </div>

        <h2 class="text-2xl font-bold text-gray-900 mb-4">Lista de Tareas</h2>
        <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prioridad</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acción</th>
                    </tr>
                </thead>
                <tbody id="user-task-list" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
    </template>
    
    <div id="offline-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-gray-900 text-white hidden">
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
             <div class="absolute w-full h-full bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-purple-900/40 via-gray-900 to-black"></div>
        </div>

        <div class="z-10 text-center p-8 max-w-lg">
            <div class="mb-6 relative inline-block">
                <i class="fas fa-wifi text-6xl text-gray-600 animate-pulse"></i>
                <i class="fas fa-exclamation-triangle absolute -top-2 -right-2 text-3xl text-red-500 bg-gray-900 rounded-full border-2 border-gray-900"></i>
            </div>
            
            <h2 class="text-4xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-pink-600 drop-shadow-lg">
                Sin Conexión
            </h2>
            
            <p class="text-gray-300 text-lg mb-8">
                No detectamos señal de internet. <br>
                <span class="text-sm text-gray-500">Te regresaremos a tu sesión automáticamente cuando vuelvas a estar en línea.</span>
            </p>

            <div class="inline-flex items-center px-6 py-3 border border-white/10 rounded-full bg-white/5 backdrop-blur-sm">
                <div class="animate-spin rounded-full h-4 w-4 border-2 border-purple-500 border-t-transparent mr-3"></div>
                <span class="text-sm font-medium text-purple-300">Esperando reconexión...</span>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
    <script type="module" src="database.js"></script> 
    <script type="module" src="script.js"></script>
</body>
</html>